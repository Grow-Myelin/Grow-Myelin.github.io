<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <meta name="author" content="Jacob Rider">
        <link rel="canonical" href="https://Grow-Myelin.github.io/baseball_pitch_predictor/">
        <link rel="shortcut icon" href="../img/favicon.ico">
        <title>Baseball Pitch Predictor - Jacob Rider's Personal Portfolio</title>
        <link href="../css/bootstrap.min.css" rel="stylesheet">
        <link href="../css/font-awesome.min.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/atelier-cave-light.min.css">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script>hljs.highlightAll();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="..">Jacob Rider's Personal Portfolio</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-collapse">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="navitem">
                                <a href=".." class="nav-link">Home</a>
                            </li>
                            <li class="navitem">
                                <a href="../experience/" class="nav-link">Experience</a>
                            </li>
                            <li class="navitem">
                                <a href="../education/" class="nav-link">Education</a>
                            </li>
                            <li class="navitem">
                                <a href="../skills/" class="nav-link">Skills</a>
                            </li>
                            <li class="dropdown active">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Projects <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../ti4_combat_simulator/" class="dropdown-item">TI4 Combat Simulator</a>
</li>
                                    
<li>
    <a href="./" class="dropdown-item active">Baseball Pitch Predictor</a>
</li>
                                    
<li>
    <a href="../prob_prog_tools/" class="dropdown-item">Probabilistic Programming Tools</a>
</li>
                                    
<li>
    <a href="../data_tools/" class="dropdown-item">Data Tools for Economic Research</a>
</li>
                                </ul>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ml-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href="../ti4_combat_simulator/" class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="../prob_prog_tools/" class="nav-link">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-secondary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-level="1"><a href="#baseball-pitch-predictor" class="nav-link">Baseball Pitch Predictor</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#project-overview" class="nav-link">Project Overview</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#key-features" class="nav-link">Key Features</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#technologies-used" class="nav-link">Technologies Used</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#imports" class="nav-link">Imports</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#classes" class="nav-link">Classes</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#functions" class="nav-link">Functions</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#example-usage" class="nav-link">Example Usage</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="baseball-pitch-predictor">Baseball Pitch Predictor</h1>
<p><strong><a href="https://github.com/Grow-Myelin/ProbProg/tree/main/baseball">View Project on GitHub</a></strong></p>
<h2 id="project-overview">Project Overview</h2>
<p>Created a predictive model to analyze and forecast baseball pitch types based on historical pitch data.</p>
<h2 id="key-features">Key Features</h2>
<ul>
<li>Analysis of pitch frequency over varying time periods to predict the next pitch.</li>
</ul>
<h2 id="technologies-used">Technologies Used</h2>
<ul>
<li>Python</li>
<li>Jax</li>
<li>Flax</li>
</ul>
<h2 id="imports">Imports</h2>
<pre><code class="language-python">import pandas as pd
import numpy as np
import jax
import jax.numpy as jnp
from flax import linen as nn
from flax.training.train_state import TrainState
import optax
from jax.random import PRNGKey
from parsePitchData import clean_data
from sklearn.metrics import confusion_matrix
import seaborn as sns
import matplotlib.pyplot as plt
from typing import Tuple, Dict, List
import time
</code></pre>
<h2 id="classes">Classes</h2>
<h3 id="pitchpredictormodel">PitchPredictorModel</h3>
<pre><code class="language-python">class PitchPredictorModel(nn.Module):
    num_outputs: int  # Number of unique pitch types

    @nn.compact
    def __call__(self, x: jnp.ndarray) -&gt; jnp.ndarray:
        &quot;&quot;&quot;
        Forward pass for the pitch predictor model.

        Parameters:
        - x (jnp.ndarray): Input tensor with shape (batch_size, 4, n).

        Returns:
        - jnp.ndarray: Logits tensor with shape (batch_size, num_outputs).
        &quot;&quot;&quot;
</code></pre>
<h2 id="functions">Functions</h2>
<h3 id="normalize_counts">normalize_counts</h3>
<pre><code class="language-python">def normalize_counts(pitch_counts: np.ndarray) -&gt; np.ndarray:
    &quot;&quot;&quot;
    Normalize the pitch counts to get a distribution proportion.

    Parameters:
    - pitch_counts: Array of pitch counts.

    Returns:
    - np.ndarray: Normalized distribution of pitch counts.
    &quot;&quot;&quot;
</code></pre>
<h3 id="efficient_pitch_distribution">efficient_pitch_distribution</h3>
<pre><code class="language-python">def efficient_pitch_distribution(df: pd.DataFrame, pitch_types: List[str], filter_conditions: Dict[str, str]) -&gt; np.ndarray:
    &quot;&quot;&quot;Calculate and normalize the distribution of pitch types, excluding the current event.

    Parameters:
    - df (pd.DataFrame): The dataframe containing pitch data.
    - pitch_types (List[str]): List of all possible pitch types.
    - filter_conditions (Dict[str, str]): Conditions to filter the dataframe.

    Returns:
    - np.ndarray: Normalized distribution of pitch counts.
    &quot;&quot;&quot;
</code></pre>
<h3 id="return_pitch_distributions">return_pitch_distributions</h3>
<pre><code class="language-python">def return_pitch_distributions(df: pd.DataFrame, df_row: pd.Series, pitch_types: List[str]) -&gt; jnp.ndarray:
    &quot;&quot;&quot;Calculate pitch distributions for different contexts based on a row from the dataframe.

    Parameters:
    - df (pd.DataFrame): The dataframe containing pitch data.
    - df_row (pd.Series): A row from the dataframe specifying the current event.
    - pitch_types (List[str]): List of all possible pitch types.

    Returns:
    - jnp.ndarray: Stack of normalized pitch distributions for different contexts.
    &quot;&quot;&quot;
</code></pre>
<h3 id="return_current_pitch">return_current_pitch</h3>
<pre><code class="language-python">def return_current_pitch(df_row: pd.Series, pitch_types: List[str]) -&gt; List[int]:
    &quot;&quot;&quot;Generate a one-hot encoded vector for the current pitch type.

    Parameters:
    - df_row (pd.Series): A row from the dataframe specifying the current event.
    - pitch_types (List[str]): List of all possible pitch types.

    Returns:
    - List[int]: One-hot encoded vector representing the current pitch type.
    &quot;&quot;&quot;
</code></pre>
<h3 id="clean_data">clean_data()</h3>
<pre><code class="language-python">def clean_data() -&gt; Tuple[jnp.ndarray, jnp.ndarray]:
    &quot;&quot;&quot;Load, preprocess data, and compute pitch distributions.

    Returns:
    - Tuple[jnp.ndarray, jnp.ndarray]: Tuple of inputs and outputs for modeling.
    &quot;&quot;&quot;
</code></pre>
<h3 id="cross_entropy_loss">cross_entropy_loss()</h3>
<pre><code class="language-python">def cross_entropy_loss(logits: jnp.ndarray, labels: jnp.ndarray) -&gt; jnp.ndarray:
    &quot;&quot;&quot;
    Computes the cross-entropy loss between logits and labels.

    Parameters:
    - logits (jnp.ndarray): Predictions from model.
    - labels (jnp.ndarray): True labels, one-hot encoded.

    Returns:
    - jnp.ndarray: Cross-entropy loss.
    &quot;&quot;&quot;
</code></pre>
<h3 id="compute_accuracy">compute_accuracy()</h3>
<pre><code class="language-python">def compute_accuracy(logits: jnp.ndarray, labels: jnp.ndarray) -&gt; float:
    &quot;&quot;&quot;
    Computes the accuracy of the predictions.

    Parameters:
    - logits (jnp.ndarray): Predictions from model.
    - labels (jnp.ndarray): True labels, one-hot encoded.

    Returns:
    - float: Accuracy of predictions.
    &quot;&quot;&quot;
</code></pre>
<h3 id="create_train_state">create_train_state()</h3>
<pre><code class="language-python">def create_train_state(rng: PRNGKey, learning_rate: float, num_outputs: int) -&gt; TrainState:
    &quot;&quot;&quot;
    Initializes the model's train state.

    Parameters:
    - rng (PRNGKey): Random number generator key.
    - learning_rate (float): Learning rate for the optimizer.
    - num_outputs (int): Number of unique pitch types.

    Returns:
    - TrainState: The initialized training state.
    &quot;&quot;&quot;
</code></pre>
<h3 id="train_step">train_step()</h3>
<pre><code class="language-python">def train_step(state: TrainState, batch: dict) -&gt; tuple:
    &quot;&quot;&quot;
    Performs a single training step.

    Parameters:
    - state (TrainState): Current training state.
    - batch (dict): Batch of data containing 'inputs' and 'targets'.

    Returns:
    - tuple: Updated state, loss, and accuracy for the batch.
    &quot;&quot;&quot;
</code></pre>
<h3 id="train_model">train_model()</h3>
<pre><code class="language-python">def train_model(num_epochs: int, learning_rate: float, num_outputs: int, train_data: list) -&gt; None:
    &quot;&quot;&quot;
    Trains the model.

    Parameters:
    - num_epochs (int): Number of epochs to train for.
    - learning_rate (float): Learning rate for the optimizer.
    - num_outputs (int): Number of unique pitch types.
    - train_data (list): Training data.
    &quot;&quot;&quot;
</code></pre>
<h2 id="example-usage">Example Usage</h2>
<pre><code class="language-python">def main():
    inputs, outputs = clean_data()  # Assuming this returns correctly shaped data
    n = outputs.shape[1]
    learning_rate = 0.001
    num_epochs = 10
    # Placeholder class weights calculation
    # You should calculate these based on your dataset's specific class distribution
    class_weights = jnp.array([1.0,5.0,5.0,5.0])  # Example weights for 3 classes


    # Splitting data into training and testing sets
    num_training = int(0.8 * len(inputs))
    train_inputs, test_inputs = inputs[:num_training], inputs[num_training:]
    train_outputs, test_outputs = outputs[:num_training], outputs[num_training:]

    # Initialize the model and training state
    rng = PRNGKey(0)
    state = create_train_state(rng, learning_rate, n)

    # Adjusted training loop
    for epoch in range(num_epochs):
        epoch_loss = 0
        epoch_accuracy = 0
        num_batches = len(train_inputs)  # Assuming batch size of 1 for simplicity
        for i in range(num_batches):
            inputs = train_inputs[i].reshape(1, 4, n)
            outputs = train_outputs[i].reshape(1, n)
            state, loss, accuracy = train_step(state, {'inputs': inputs, 'targets': outputs})
            epoch_loss += loss
            epoch_accuracy += accuracy
        epoch_loss /= num_batches
        epoch_accuracy /= num_batches
        print(f&quot;Epoch {epoch}, Loss: {epoch_loss}, Accuracy: {epoch_accuracy}&quot;)


    # The rest of your code remains unchanged up to the prediction part...

    # No need to reinitialize the model if we are using the trained state
    # model = PitchPredictorModel(num_outputs=n)  # Remove or comment out this line

    # Initialize a list to store prediction logits
    test_pred_logits = []

    # Predict in a loop
    for i in range(len(test_inputs)):
        # Reshape the input correctly as the model expects
        test_input_reshaped = test_inputs[i].reshape(1, 4, n)
        # Correctly use the trained parameters for prediction
        logits = state.apply_fn({'params': state.params}, test_input_reshaped)
        test_pred_logits.append(logits)

    # Assuming test_pred_logits is now a list of arrays, stack them
    test_pred_logits = jnp.vstack(test_pred_logits)  # Stack logits for further processing

    # Convert logits to predicted class indices
    test_pred_labels = jnp.argmax(test_pred_logits, axis=-1)

    # Ensure true_labels is correctly prepared from test_outputs
    true_labels = jnp.argmax(test_outputs, axis=-1)

    # Compute the confusion matrix
    cm = confusion_matrix(true_labels, test_pred_labels)

    # Plot the confusion matrix
    plt.figure(figsize=(10, 7))
    sns.heatmap(cm, annot=True, fmt='d', cmap='Blues')
    plt.xlabel('Predicted Labels')
    plt.ylabel('True Labels')
    plt.title('Confusion Matrix')
    plt.savefig('plots/prediction_results1.png')
if __name__ == &quot;__main__&quot;:
    main()
</code></pre>
<hr />
<p><a href="../experience/">Experience</a> | <a href="../education/">Education</a> | <a href="../skills/">Skills</a> | <a href="../projects/"><strong>Projects</strong></a></p>
<hr />
<p><a href="../ti4_combat_simulator/">TI4 Combat Simulator</a> | <a href="./"><strong>Baseball Pitch Predictor</strong></a> | <a href="../prob_prog_tools/">Probabalistic Programming Tools</a> | <a href="../data_tools/">Data Tools</a></p></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script src="../js/jquery-3.6.0.min.js"></script>
        <script src="../js/bootstrap.min.js"></script>
        <script>
            var base_url = "..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../js/base.js"></script>
        <script src="../search/main.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
