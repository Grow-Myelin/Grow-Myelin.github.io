<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <meta name="author" content="Jacob Rider">
        <link rel="canonical" href="https://Grow-Myelin.github.io/ti4_combat_simulator/">
        <link rel="shortcut icon" href="../img/favicon.ico">
        <title>TI4 Combat Simulator - Jacob Rider's Portfolio</title>
        <link href="../css/bootstrap.min.css" rel="stylesheet">
        <link href="../css/font-awesome.min.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/atelier-cave-light.min.css">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script>hljs.highlightAll();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="..">Jacob Rider's Portfolio</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-collapse">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="navitem">
                                <a href=".." class="nav-link">Home</a>
                            </li>
                            <li class="navitem">
                                <a href="../experience/" class="nav-link">Experience</a>
                            </li>
                            <li class="navitem">
                                <a href="../education/" class="nav-link">Education</a>
                            </li>
                            <li class="navitem">
                                <a href="../skills/" class="nav-link">Skills</a>
                            </li>
                            <li class="dropdown active">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Projects <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="./" class="dropdown-item active">TI4 Combat Simulator</a>
</li>
                                    
<li>
    <a href="../baseball_pitch_predictor/" class="dropdown-item">Baseball Pitch Predictor</a>
</li>
                                    
<li>
    <a href="../prob_prog_tools/" class="dropdown-item">Probabilistic Programming Tools</a>
</li>
                                    
<li>
    <a href="../data_tools/" class="dropdown-item">Data Tools for Economic Research</a>
</li>
                                </ul>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ml-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href="../skills/" class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="../baseball_pitch_predictor/" class="nav-link">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-secondary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-level="1"><a href="#ti4-combat-simulator" class="nav-link">TI4 Combat Simulator</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#project-background" class="nav-link">Project Background</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#project-overview" class="nav-link">Project Overview</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#technologies-used" class="nav-link">Technologies Used</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#imports" class="nav-link">Imports</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#types" class="nav-link">Types</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#functions" class="nav-link">Functions</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#example-usage" class="nav-link">Example Usage</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="ti4-combat-simulator">TI4 Combat Simulator</h1>
<p><strong><a href="https://github.com/Grow-Myelin/ProbProg/tree/main/TI4">View Project on GitHub</a></strong>
<strong><a href="../pdfs/ti4_seaborn.pdf">Output graph</a></strong></p>
<h2 id="project-background">Project Background</h2>
<p>Twilight Imperium (TI4) is a strategy board game known for its intricate diplomacy, expansive empire-building, and epic space battles. Engaging in combat within TI4 demands a sophisticated interplay of analysis, meticulous planning, and an element of chance. The combat mechanics of TI4 infuse unpredictability by integrating dice rolls to influence battle outcomes. Historically, navigating TI4's combat landscape has been a challenge, rendering forecasting methods based solely on unit statistics and strategic maneuvers insufficient.</p>
<h2 id="project-overview">Project Overview</h2>
<p>This combat simulator for TI4 utilizes Monte Carlo methods and probability theory to model the distribution of outcomes for in-game combat scenarios. This tool helps players understand the potential outcomes of their strategic decisions in combat, aiding in planning and execution during gameplay.</p>
<h2 id="technologies-used">Technologies Used</h2>
<ul>
<li>Python</li>
<li>Jax</li>
<li>Seaborn</li>
</ul>
<p>This document describes a set of functions for simulating combat scenarios using JAX.</p>
<h2 id="imports">Imports</h2>
<pre><code class="language-python">import jax.numpy as jnp
from jax import random
import os
from typing import Dict, Tuple, Any
import matplotlib.pyplot as plt
from collections import defaultdict
import pandas as pd
import seaborn as sns
</code></pre>
<h2 id="types">Types</h2>
<pre><code class="language-python">KeyType = Tuple[int, float]
SideType = Dict[KeyType, int]
RNGKey = Any
</code></pre>
<h2 id="functions">Functions</h2>
<h4 id="apply_hits">apply_hits</h4>
<pre><code class="language-python">def apply_hits(side: SideType, hits_scored: int, rng_key: RNGKey) -&gt; SideType:
    &quot;&quot;&quot;
    Apply hits to a side with JAX, prioritizing dice with lower hit probabilities 
    and lower health. Incorporates randomness in selecting dice within the same 
    priority level to take hits. Accepts an RNG key for reproducible randomness.

    Parameters:
        side (SideType): Dictionary representing the side's units and their stats.
        hits_scored (int): Number of hits to apply to the side.
        rng_key (RNGKey): JAX random key for generating random numbers.

    Returns:
        SideType: Updated side after applying hits.
    &quot;&quot;&quot;
</code></pre>
<h4 id="simulate_combat_round">simulate_combat_round</h4>
<pre><code class="language-python">def simulate_combat_round(side_a: SideType, side_b: SideType, rng_key: RNGKey) -&gt; Tuple[SideType, SideType]:
    &quot;&quot;&quot;
    Simulates a single round of combat between two sides.

    Parameters:
        side_a (SideType): The initial state of side A.
        side_b (SideType): The initial state of side B.
        rng_key (RNGKey): A random key for JAX's random number generation.

    Returns:
        Tuple[SideType, SideType]: The updated states of side A and side B after the combat round.
    &quot;&quot;&quot;
</code></pre>
<h4 id="run_combat_until_elimination">run_combat_until_elimination</h4>
<pre><code class="language-python">def run_combat_until_elimination(side_a: SideType, side_b: SideType, rng_key: RNGKey, max_rounds: int = 1000) -&gt; Tuple[SideType, SideType, int, SideType, SideType]:
    &quot;&quot;&quot;
    Runs combat rounds between two sides until one side is eliminated or a maximum
    number of rounds is reached, also returns the initial states.

    Parameters:
    - side_a (SideType): Initial state of side A.
    - side_b (SideType): Initial state of side B.
    - rng_key (RNGKey): JAX random key for generating random numbers.
    - max_rounds (int, optional): Maximum number of rounds to simulate. Defaults to 1000.

    Returns:
    - Tuple[SideType, SideType, int, SideType, SideType]: Final states of side A and side B,
      the number of rounds simulated, and copies of the initial states of side A and side B.
    &quot;&quot;&quot;
</code></pre>
<h4 id="state_to_string">state_to_string</h4>
<pre><code class="language-python">def state_to_string(state: SideType) -&gt; str:
    &quot;&quot;&quot;
    Converts a side's state to a string representation for consistent key usage.

    This function sorts the units in the side by their hit probabilities and health
    before converting to string, ensuring consistent string representation for
    identical states.

    Parameters:
    - state (SideType): The current state of the side's units, represented as a
      dictionary with keys as (unit health, hit probability) and values as unit counts.

    Returns:
    - str: A string representation of the state, sorted by unit properties.
    &quot;&quot;&quot;
</code></pre>
<h4 id="calculate_health">calculate_health</h4>
<pre><code class="language-python">def calculate_health(state_str: str) -&gt; int:
    &quot;&quot;&quot;
    Calculates the total health score based on a side's state string representation.

    This function interprets the state string, extracting unit health and count
    to compute the overall health score of the side.

    Parameters:
    - state_str (str): A string representation of a side's state, typically
      obtained from `state_to_string` function.

    Returns:
    - int: The total health score calculated from the state.
    &quot;&quot;&quot;
</code></pre>
<h4 id="monte_carlo_combat_simulation">monte_carlo_combat_simulation</h4>
<pre><code class="language-python">def mc(initial_side_a,initial_side_b,num_simulations):
    &quot;&quot;&quot;
    Conducts a Monte Carlo simulation to estimate the outcome probabilities of combat between two sides.

    Parameters:
        initial_side_a (SideType): The initial state of side A.
        initial_side_b (SideType): The initial state of side B.
        num_simulations (int): The number of simulations to run.

    Returns:
        Tuple[List[str], List[int]]: The outcomes (as labels) and their counts.
    &quot;&quot;&quot;
</code></pre>
<h4 id="normalize">normalize</h4>
<pre><code class="language-python">def normalize(all_labels,all_values):
    &quot;&quot;&quot;
    Normalizes the simulation counts to probabilities

    Parameters:
        all_labels (List[str]): The labels for each outcome.
        all_values (List[int]): The counts for each outcome.
        filename (str): The file path to save the plot.

    Returns:
        data (pd.DataFrame): data to plot
    &quot;&quot;&quot;
</code></pre>
<h4 id="plot_and_simulate_data">plot_and_simulate_data</h4>
<pre><code class="language-python">def plot_and_simulate_data(initial_side_a,initial_side_b,num_simulations):
    &quot;&quot;&quot;
    Runs Monte Carlo simulations to estimate combat outcomes between two sides and plots the results.

    This function orchestrates the simulation process by calling the appropriate functions to
    simulate combat, calculate outcome probabilities, and plot the probabilities in a bar plot.

    Parameters:
    - initial_side_a (SideType): The initial state of side A.
    - initial_side_b (SideType): The initial state of side B.
    - num_simulations (int): The number of simulations to run for estimating outcomes.

    The function does not return a value but generates and saves a plot visualizing the
    probability of different outcomes based on the simulations.
    &quot;&quot;&quot;
</code></pre>
<h2 id="example-usage">Example Usage</h2>
<p><em>The following is an example of 2 dreadnaughts, each with 2 health hitting 60% of the time fighting vs 6 fighters, each with 1 health hitting 20% of the time.</em></p>
<pre><code class="language-python">initial_side_a = {(2, 0.6): 3}
initial_side_b = {(1, 0.2): 6}
num_simulations = 10000
plot_and_simulate_data(initial_side_a,initial_side_b,num_simulations)
</code></pre>
<hr />
<p><a href="../experience/">Experience</a> | <a href="../education/">Education</a> | <a href="../skills/">Skills</a> | <a href="../projects/"><strong>Projects</strong></a></p>
<hr />
<p><a href="./"><strong>TI4 Combat Simulator</strong></a> | <a href="../baseball_pitch_predictor/">Baseball Pitch Predictor</a> | <a href="../prob_prog_tools/">Probabalistic Programming Tools</a> | <a href="../data_tools/">Data Tools</a></p></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script src="../js/jquery-3.6.0.min.js"></script>
        <script src="../js/bootstrap.min.js"></script>
        <script>
            var base_url = "..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../js/base.js"></script>
        <script src="../search/main.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
